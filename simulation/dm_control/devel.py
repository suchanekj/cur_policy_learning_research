import numpy as np
from dm_control import viewer
import simulation_control.environments as environments
import os
from config import *
from genetic_algorithm import load_hof, evaluate
from simulation.dm_control.genetic_algorithm import load_hof, evaluate

hof = load_hof(path=f'{HOF_OUTPUT_DIRECTORY}{os.listdir(HOF_OUTPUT_DIRECTORY)[-1]}').reshape(NUM_STEPS * 10, INPUT_SIZE)
# hof = load_hof(path=f'{HOF_OUTPUT_DIRECTORY}{os.listdir(HOF_OUTPUT_DIRECTORY)[-1]}')\
#     .reshape(NUM_STEPS, INPUT_SIZE)
ctr = -1


def hof_policy(time_step):
    print(time_step)
    global ctr
    # moves until last action, then keeps doing the last action
    if ctr < len(hof) - 1:
        ctr += 1
    return hof[ctr]
#
sapi = SimulationAPI()
sapi.rebuild_XML()
env = environments.load(domain_name='passive_hand', task_name='lift_sparse')

viewer.launch(env, policy=hof_policy)
viewer.launch(env, policy=lambda x:np.zeros((5,)))
